# File: conf/machine/x86_64.conf
DESCRIPTION = "Minimal configuration for x86_64, suitable for QEMU and bootable USB."

# Specifies the architecture and ABI
TARGET_ARCH = "x86_64"
TARGET_CPU = "x86-64"

# Specifies the type of machine and default root filesystem image type
MACHINE = "genericx86-64"
MACHINE_FEATURES = "pcbios efi usbhost"

# Use ext4 as the default filesystem, which is compatible with USB drives
IMAGE_FSTYPES += "ext4 wic.gz"

# Set the image format and compression options
# 'wic.gz' creates a compressed .wic image, suitable for USB boot.
WKS_FILE = "ahk-thin_client.wks"

# Kernel and init system settings
PREFERRED_PROVIDER_virtual/kernel = "linux-yocto"
PREFERRED_PROVIDER_virtual/bootloader = "grub-efi"
PREFERRED_VERSION_linux-yocto = "5.15%"

# Additional bootloader settings
EFI_PROVIDER = "grub-efi"
GRUB_SERIAL_OUTPUT = "console"
GRUB_TIMEOUT = "5"
SERIAL_CONSOLE = "115200 ttyS0"

# Enable QEMU support
QB_SYSTEM_NAME = "qemu-system-x86_64"
QB_MACHINE = "-machine q35"
QB_CPU = "-cpu host"
QB_KERNEL_CMDLINE_APPEND = "console=ttyS0"
